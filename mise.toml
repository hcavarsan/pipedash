[tools]
"rust" = { version = "nightly", components = "rust-src,llvm-tools,clippy,rustfmt" }
node = "24"
bun = "latest"

[tasks.install]
description = "Install all dependencies"
run = "bun install"

[tasks."install:ios"]
description = "Initialize iOS development (requires Xcode)"
run = "bun run tauri ios init"

[tasks."install:android"]
description = "Initialize Android development (requires Android SDK)"
run = "bun run tauri android init"

[tasks.dev]
description = "Start full Tauri development mode"
run = "bun run tauri dev"

[tasks."dev:front"]
description = "Start frontend development server only"
run = "bun run dev"

[tasks."dev:ios"]
description = "Start iOS development mode"
run = "bun run tauri ios dev"

[tasks."dev:android"]
description = "Start Android development mode"
run = "bun run tauri android dev"

[tasks.build]
description = "Build full Tauri application for production"
run = "bun run tauri build -- --features custom-protocol"

[tasks."build:ios"]
description = "Build iOS application"
run = "bun run tauri ios build"

[tasks."build:android"]
description = "Build Android application"
run = "bun run tauri android build"

[tasks."build:front"]
description = "Build frontend only"
run = "bun run build"

[tasks."build:back"]
description = "Build backend only"
run = "cargo build --release --workspace"

[tasks."build:analyze"]
description = "Build frontend with bundle analysis"
run = "ANALYZE=true bun run build"

[tasks.check]
description = "Run all type and syntax checking"
depends = ["check:front", "check:back"]

[tasks."check:front"]
description = "Run frontend TypeScript type checking"
run = "bun run tsc --noEmit && bun run eslint"

[tasks."check:back"]
description = "Run backend cargo check"
run = "cargo check --workspace --all-targets --all-features"

[tasks.lint]
description = "Lint frontend and backend code"
depends = ["lint:front", "lint:back"]

[tasks."lint:front"]
description = "Lint frontend code with ESLint"
run = "bun run eslint:fix"

[tasks."lint:back"]
description = "Lint backend code with Clippy"
run = "cargo clippy --workspace --all-targets --all-features -- -D warnings"

[tasks.format]
description = "Format frontend and backend code"
depends = ["format:front", "format:back"]

[tasks."format:front"]
description = "Format frontend code with ESLint"
run = "bun run eslint:fix"

[tasks."format:back"]
description = "Format backend code with rustfmt"
run = "rustup run nightly cargo fmt --all"

[tasks."format:check"]
description = "Check formatting without fixing"
depends = ["format:front:check", "format:back:check"]

[tasks."format:front:check"]
description = "Check frontend formatting"
run = "bun run eslint"

[tasks."format:back:check"]
description = "Check backend formatting"
run = "cargo +nightly fmt --all -- --check"

[tasks.knip]
description = "Detect unused exports and dependencies"
run = "bun run knip"

[tasks."bump:patch"]
description = "Bump patch version and commit"
run = "cd hacks && cargo run --bin bump_version patch && cd .. && cargo update --workspace && git add . && git commit -m 'chore: bump version'"

[tasks."bump:minor"]
description = "Bump minor version and commit"
run = "cd hacks && cargo run --bin bump_version minor && cd .. && cargo update --workspace && git add . && git commit -m 'chore: bump version'"

[tasks."bump:major"]
description = "Bump major version and commit"
run = "cd hacks && cargo run --bin bump_version major && cd .. && cargo update --workspace && git add . && git commit -m 'chore: bump version'"

[tasks.release]
description = "Full release workflow"
run = [
  "mise run format:check",
  "mise run lint",
  "mise run check",
  "mise run build"
]

[tasks.icons]
description = "Generate application icons"
run = "cargo run --bin generate_icons"

[tasks.deps]
description = "Update dependencies to latest major versions"
run = "bunx taze major -I"

[tasks."deps:minor"]
description = "Update dependencies to latest minor versions"
run = "bunx taze minor -w"

[tasks.ci]
description = "Run all CI checks"
depends = ["format:check", "lint", "check"]

[tasks."ci:front"]
description = "Run frontend CI checks"
depends = ["format:front:check", "lint:front", "check:front"]

[tasks."ci:back"]
description = "Run backend CI checks"
depends = ["format:back:check", "lint:back", "check:back"]

[tasks.precommit]
description = "Run pre-commit checks"
run = [
  "mise run format",
  "mise run lint",
  "mise run check",
  "git add ."
]
